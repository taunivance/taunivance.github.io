var banner_end = false,
main_tl = new TimelineMax(),
neon_anim = new TimelineMax(),
start_pulse = 'start+=1.5',
fade_count = 0,
delay_fade = get_random(4,7)
;

init = function(){
	var neon = ['.neon1','.neon2','.neon3','.neon4','.neon5','.neon6','.neon7','.neon8','.neon9','.neon10','.neon11','.neon12','.neon13'];
	var shuffle = [].slice.call(document.querySelectorAll(neon));
	shuffle_array(shuffle);
	
	/* Animation */
	function intro_anim() {
		var intro_tl = new TimelineMax();
		intro_tl
			.set('.show',{autoAlpha:1})
			.set('#cta',{autoAlpha:0})
			.set('#copy1_mask,#copy3_mask',{y:-27})
						
			.add('start','+=.02')
			.from('#divider',.7,{width:0,ease:Power4.easeInOut},'start+=.3')
			.to('#divider',.7,{y:-27,ease:Power4.easeInOut},'start+=1.1')
			.from(shuffle,.1,{opacity:0,ease:Power0.easeNone},'start+=1.5')
			.to('#fader',.1,{opacity:0,ease:Power0.easeNone},'start+=1.5')
			.to('.neon1',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon1']},start_pulse)
	    	.to('.neon2',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon2']},start_pulse)
	    	.to('.neon3',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon3']},start_pulse)
	    	.to('.neon4',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon4']},start_pulse)
	    	.to('.neon5',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon5']},start_pulse)
	    	.to('.neon6',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon6']},start_pulse)
	    	.to('.neon7',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon7']},start_pulse)
	    	.to('.neon8',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon8']},start_pulse)
	    	.to('.neon9',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon9']},start_pulse)
	    	.to('.neon10',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon10']},start_pulse)
	    	.to('.neon11',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon11']},start_pulse)
	    	.to('.neon12',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon12']},start_pulse)
	    	.to('.neon13',.1,{opacity:1,onComplete:flicker,onCompleteParams:['.neon13']},start_pulse)
			//.to('#fader',.1,{opacity:0,onComplete:fade,onCompleteParams:['#fader']},start_pulse)
			.to('#divider,#copy1_mask',.7,{y:0,ease:Power4.easeInOut},'start+=2')
			.from('#copy2',.7,{autoAlpha:0,ease:Power4.easeOut},'start+=3')
			
			.add('frame2','+=2')
			.to('#copy1,#copy2',.3,{autoAlpha:0,ease:Power0.easeNone},'frame2')
			.to('#divider',.7,{y:-27,ease:Power4.easeInOut},'frame2')
			.to('#divider',.4,{width:206,ease:Power4.easeInOut},'frame2+=.7')
			.to('#divider',.7,{y:-8,ease:Power4.easeInOut},'frame2+=1')
			.to('#copy3_mask',.7,{y:0,ease:Power4.easeInOut},'frame2+=1')
			.from('#copy4',.7,{autoAlpha:0,ease:Power4.easeOut},'frame2+=2')
			
			.add('frame3','+=2')
			.to('#copy3,#copy4,#divider',.3,{autoAlpha:0,ease:Power0.easeNone},'frame3')
			.from('#copy5',.7,{autoAlpha:0,ease:Power4.easeOut},'frame3+=1')
			
			.add('frame4','+=2')
			.to('#copy5',.3,{autoAlpha:0,ease:Power0.easeNone},'frame4')
			.from('#copy6',.7,{autoAlpha:0,ease:Power4.easeOut},'frame4+=1')
			.to('#x_footer_copy',.3,{autoAlpha:0,ease:Power0.easeNone},'frame4+=2')
			.to('#cta',1,{autoAlpha:1,ease:Power4.easeOut},'frame4+=2.3')
			.to('#x_car_reflection',2,{autoAlpha:0,ease:Power0.easeNone},'frame4-=1.5')
						
			.add(banner_done);
		;
		//intro_tl.addPause(3.5);
		return intro_tl;
	};
	
	function banner_done() {
		banner_end = true;
	};
	
	function animate() {
		main_tl
			.addLabel('start')
			.to('#loading',.2,{autoAlpha:0,ease:Power1.easeOut},'start')
			.add(intro_anim(),'start')
		;
		//main_tl.seek(8);
		//main_tl.timeScale(.8);
	};
	
	function flicker(object) {
		flicker_anim = new TimelineMax();
		flicker_anim
		.to(object,1,{opacity:1,ease:RoughEase.ease.config({points:get_random(0,3),strength:1,clamp:true})})
		.to(object,get_random(.5,.9),{
			opacity:get_random(.75,.99),
			ease:RoughEase.ease.config({points:get_random(0,3),strength:1,clamp:true}),
			delay:get_random(0,7),
			onComplete:flicker,
	        onCompleteParams:[object]
		});
	};
	
	function fade(object) {
		if(banner_end) {
			delay_fade = get_random(.1,.9);
		}
		if(fade_count < 2) {
			fade_count++;
			fader_anim = new TimelineMax();
			fader_anim
			.to(object,1,{opacity:0,ease:RoughEase.ease.config({points:get_random(0,3),strength:1,clamp:true})})
			.to(object,get_random(.5,.9),{
				opacity:get_random(.1,.2),
				ease:RoughEase.ease.config({points:get_random(0,3),strength:1,clamp:true}),
				delay:delay_fade,
				onComplete:fade,
		        onCompleteParams:[object]
			});
		} else {
			fader_anim = new TimelineMax();
			fader_anim
			.to(object,1,{opacity:0,ease:RoughEase.ease.config({points:get_random(0,3),strength:1,clamp:true})})
		}
	};
	
	/* Add Listeners */
    function addlisteners() {
    	document.getElementById('lexus').addEventListener('mouseover', function() {
	    	//if(banner_end) {
		    	TweenMax.to('#cta',.1,{backgroundColor:'#000000'});
            	TweenMax.to('#cta_txt path',.1,{fill:'#ffffff'});
            //}
    	});
        document.getElementById('lexus').addEventListener('mouseout', function() {
			//if(banner_end) {
				TweenMax.to('#cta',.1,{backgroundColor:'#f1f1f1'});
            	TweenMax.to('#cta_txt path',.1,{fill:'#000000'});
			//}
		});
    };
    
    animate();
    addlisteners();
}

//Helper Functions
function get_random(min,max) {
	return min + Math.random() * (max - min);
}

function shuffle_array(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    return array;
};