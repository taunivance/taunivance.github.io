var sas_csync_DEBUG=!1,sasCookieSync=sasCookieSync||function(k,h){sas_csync_DEBUG&&console.log("sasCookieSync is created.");return{protocol:(k.location.protocol||"").replace(":",""),cookies:{},qs:{},logDebug:function(){sas_csync_DEBUG&&console.log.apply(null,["CookieSync"].concat([].slice.apply(arguments)))},init:function(){this.cookies=this.parseCookies(h.cookie);this.qs=this.parseQueryString(k.location.search.substr(1))},parseQueryString:function(b){b=b.split("&");for(var c={},a=0;a<b.length;++a){var d=
b[a].split("=");2==d.length&&(c[d[0]]=decodeURIComponent(d[1].replace(/\+/g," ")))}return c},getIntFromParsedQueryString:function(b,c){var a=parseInt(b[c],10);return isNaN(a)||0>a?0:a},parseValues:function(b,c,a){var d={};b=b.split(c);for(c=0;c<b.length;c++){var e=b[c],f=e.indexOf(a),g=e.substring(0,f),e=e.substring(f+1);d[g]=decodeURIComponent(e)}return d},parseCookies:function(b){return b?this.parseValues(b,"; ","="):{}},removeKnownPools:function(b,c){this.logDebug("removeKnownPools");if(this.doesCookieExists(c,
"csync"))for(var a=c.csync.split("|"),d=0;d<a.length;d++){var e=a[d],f=e.indexOf(":");0<f&&(e=e.substring(0,f),delete b[e],this.logDebug("pool removed "+e))}},removeRefreshedAndUnknownPools:function(b,c){this.logDebug("removeRefreshedAndUnknownPools");poolsToRefresh=c.rpools.split("|");for(var a in b)poolsToRefresh.includes(a)||(delete b[a],this.logDebug("pool removed "+a))},shouldRefreshCsync:function(b){return this.doesCookieExists(b,"rpools")},doesCookieExists:function(b,c){return null!=b&&!!b[c]},
getNwId:function(){return this.getIntFromParsedQueryString(this.qs,"nwid")},getDcId:function(){return this.getIntFromParsedQueryString(this.qs,"dcid")},getGdprApplies:function(){return this.getIntFromParsedQueryString(this.qs,"gdpr")},getGdprConsent:function(){return this.qs.gdprc||""},getRules:function(b,c){var a=[],d=null;try{d=c?new ConsentString(c):null}catch(e){}this.logDebug("consent",d);for(var f in b)this.logDebug("partner gdprRule",b[f].gdprRule),a.push(null==d?null==b[f].gdprRule||0==b[f].gdprRule:
d.isVendorAllowed(45)&&d.isVendorAllowed(b[f].vendorId));return a},selectAllPools:function(b){var c=[],a=this.getDcId();this.logDebug("dcid",a);for(var d in b){var e=b[d][a];e&&c.push(e)}return c.sort(function(a,b){return b.priority-a.priority})},createImg:function(b,c){var a=new Image;a.src=b;a.height=1;a.width=1;null!=c&&this.populateTagAttributes(a,c);this.logDebug("sasCookieSync in image");return a},createScript:function(b,c){var a=h.createElement("SCRIPT");a.src=b;a.type="text/javascript";a.async=
!0;null!=c&&this.populateTagAttributes(a,c);null!=h.body&&(h.body.appendChild(a),this.logDebug("sasCookieSync in script"));return a},createIFrm:function(b,c){var a=h.createElement("IFRAME");a.src=b;a.scrolling="no";a.frameBorder=0;a.width=0;a.height=0;a.style.margin=0;a.style.padding=0;a.style.display="none";a.style.width="0px";a.style.height="0px";null!=c&&this.populateTagAttributes(a,c);null!=h.body&&(h.body.appendChild(a),this.logDebug("sasCookieSync in iframe"));return a},populateTagAttributes:function(b,
c){for(var a in c)c.hasOwnProperty(a)&&(b.dataset[c[a].attributeName]=c[a].attributeValue)},fireCSync:function(b){this.logDebug("Firing csync");this.shouldRefreshCsync(this.cookies)?this.removeRefreshedAndUnknownPools(b,this.cookies):this.removeKnownPools(b,this.cookies);var c=this.getGdprApplies(),a=this.getGdprConsent();b=this.selectAllPools(b);for(var d=this.getRules(b,a),e=0;e<b.length;e++)if(c&&!d[e])this.logDebug("pool blocked by GDPR");else{var f=b[e],g=f[this.protocol];if(g){var h=f.tag_attributes,
k=f.type;f.isGdprSupported&&(g+=0>g.indexOf("?")?"?":"&",g+="gdpr="+(c?"1":"0")+"&gdpr_consent="+a);this.logDebug("src",g);this.logDebug("type",k);switch(k){case 0:this.createImg(g,h);break;case 1:this.createScript(g,h);break;case 2:this.createIFrm(g,h)}}else this.logDebug("no src found")}}}}(window,document);sasCookieSync.init();
